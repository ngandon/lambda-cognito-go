{"version":3,"sources":["lib/contextLib.js","pages/SignInForm.js","pages/Welcome.js","App.js","config.js","index.js"],"names":["AppContext","createContext","useAppContext","useContext","SignInForm","isAuthenticated","userHasAuthenticated","useState","email","setEmail","password","setPassword","history","useHistory","useEffect","push","className","onSubmit","a","Auth","signIn","alert","message","htmlFor","type","id","placeholder","name","value","onChange","event","target","Welcome","status","setStatus","initialCheck","setInitialCheck","idToken","signOut","getStatus","API","get","headers","response","console","log","state","machine","error","post","onClick","App","isAuthenticating","setIsAuthenticating","setIdToken","currentSession","res","token","getIdToken","getJwtToken","onLoad","PrivateRoute","children","rest","to","Provider","basename","path","config","apiGateway","REGION","URL","cognito","USER_POOL_ID","APP_CLIENT_ID","Amplify","configure","mandatorySignIn","region","userPoolId","userPoolWebClientId","endpoints","endpoint","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.74e479b7.chunk.js","sourcesContent":["import { useContext, createContext } from \"react\";\n\nexport const AppContext = createContext(null);\n\nexport function useAppContext() {\n  return useContext(AppContext);\n}\n","import React, { useState, useEffect } from \"react\";\nimport { Auth } from \"aws-amplify\";\nimport { useAppContext } from \"../lib/contextLib\";\nimport { useHistory } from \"react-router\";\n\nconst SignInForm = () => {\n\n    const { isAuthenticated, userHasAuthenticated } = useAppContext();\n    const [email, setEmail] = useState(\"\");\n    const [password, setPassword] = useState(\"\");\n    const history = useHistory();\n\n    const handleChangeUsename = event => {\n        setEmail(event.target.value);\n      };\n\n    const handleChangePassword = event => {\n        setPassword(event.target.value);  \n    };\n\n    const handleSubmit = () => {\n        (async () => {\n            try {\n                await Auth.signIn(email, password);\n                userHasAuthenticated(true);\n                alert(\"Logged in\");\n                \n            } catch (e) {\n                alert(e.message);\n            }\n        })();\n        history.push(\"/welcome\");\n    };\n\n    useEffect(() => {\n        // Redirect to the logged in pages if the user is logged in\n        if (isAuthenticated) {\n            history.push(\"/welcome\");\n        }\n    }, [isAuthenticated, history]);\n\n    return (\n    <div className=\"formCenter\">\n        <form className=\"formFields\" onSubmit={handleSubmit}>\n        <div className=\"formField\">\n            <label className=\"formFieldLabel\" htmlFor=\"email\">\n            E-Mail Address\n            </label>\n            <input\n            type=\"email\"\n            id=\"email\"\n            className=\"formFieldInput\"\n            placeholder=\"Enter your email\"\n            name=\"email\"\n            value={email}\n            onChange={handleChangeUsename}\n            />\n        </div>\n\n        <div className=\"formField\">\n            <label className=\"formFieldLabel\" htmlFor=\"password\">\n            Password\n            </label>\n            <input\n            type=\"password\"\n            id=\"password\"\n            className=\"formFieldInput\"\n            placeholder=\"Enter your password\"\n            name=\"password\"\n            value={password}\n            onChange={handleChangePassword}\n            />\n        </div>\n\n        <div className=\"formField\">\n            <button className=\"formFieldButton\">Sign In</button>{\" \"}\n        </div>\n\n        </form>\n    </div>\n    );\n}\n\nexport default SignInForm;","import React, { useState, useEffect } from \"react\";\nimport { Auth } from \"aws-amplify\";\nimport { API } from \"aws-amplify\";\nimport { useAppContext } from \"../lib/contextLib\";\n\nconst Welcome = () => {\n\n    const [status, setStatus] = useState([]);\n    const [initialCheck, setInitialCheck] = useState(false);\n    const { userHasAuthenticated } = useAppContext();\n    const { idToken } = useAppContext();\n\n    async function handleLogout() {\n        await Auth.signOut();\n\n        userHasAuthenticated(false);\n    }      \n\n    // TODO : refresh token if needed\n    // eslint-disable-next-line\n    async function getStatus () {\n        if(!initialCheck){\n            setInitialCheck(true)\n        }       \n        try {\n            // const response = await API.get(\"lambda-API\", \"/Stage/open\");\n            const response = await API.get(\"lambda-API\", \"/Stage/status\",  {\n                                                                headers: {\n                                                                    \"Authorization\": idToken\n                                                                },})\n            setStatus(response)\n            console.log(response.message, response.name, response.state, response.machine)\n        } catch (e) {\n            console.error(e);\n        }\n      };\n    \n      async function startServer () {\n        try {\n            const response = await API.post(\"lambda-API\", \"/Stage/start\",  {\n                                                                headers: {\n                                                                    \"Authorization\": idToken\n                                                                },})\n            console.log(\"start\")\n            console.log(response.message)\n        } catch (e) {\n            console.error(e);\n        }\n      };\n    \n      async function stopServer () {\n        try {\n            const response = await API.post(\"lambda-API\", \"/Stage/stop\",  {\n                                                                headers: {\n                                                                    \"Authorization\": idToken\n                                                                },})\n            console.log(\"stop\")\n            console.log(response.message)\n        } catch (e) {\n            console.error(e);\n        }\n      };\n\n      useEffect(() => {\n        if(!initialCheck){\n            getStatus()\n        }\n      }, [initialCheck, getStatus]);\n\n    return (\n        <div className=\"appForm\">\n            <div><p>the status of the server <b>{status.name}</b> is {status.state} on a {status.machine} machine</p></div>\n            <div>\n                <button onClick={getStatus}>Check server status</button>\n                <button onClick={startServer}>Start the server</button>\n                <button onClick={stopServer}>Stop the server</button>\n            </div>\n            <div><button onClick={handleLogout}>Log Out</button></div>\n        </div>\n    );\n}\n\nexport default Welcome;","import React, { useState, useEffect } from \"react\";\nimport {\n    BrowserRouter as Router,\n    Redirect,\n    Route,\n    Switch,\n  } from \"react-router-dom\";\nimport SignInForm from \"./pages/SignInForm\";\nimport Welcome from \"./pages/Welcome\";\nimport { AppContext } from \"./lib/contextLib\";\nimport { Auth } from \"aws-amplify\";\nimport \"./App.css\";\n\nfunction App() {   \n\n    const [isAuthenticated, userHasAuthenticated] = useState(false);\n    const [isAuthenticating, setIsAuthenticating] = useState(true);\n    const [idToken, setIdToken] = useState();\n\n    useEffect(() => {\n        onLoad();\n      }, []);\n    \n    // load the user session\n    async function onLoad() {\n        try {\n            const res = await Auth.currentSession();\n            const token = res.getIdToken().getJwtToken();\n            console.log(token)\n            setIdToken(token)\n            console.log(\"already logged in\")\n            userHasAuthenticated(true);            \n        }\n        catch(e) {\n            if (e !== 'No current user') {\n                alert(e);\n            }\n            console.log(\"not logged in\")\n        }  \n        setIsAuthenticating(false);\n        \n    }\n      \n\n    const PrivateRoute = ({ children, ...rest }) => {\n        return (\n          <Route {...rest}>\n            {isAuthenticated ? children : <Redirect to=\"sign-in\" />}\n          </Route>\n        );\n      };\n\n    return (\n        !isAuthenticating && (\n            <AppContext.Provider value={{ isAuthenticated, userHasAuthenticated, idToken }}>\n                <Router basename=\"/react-auth-ui/\">\n                    <div className=\"App\">\n                        <div className=\"appAside\" />\n                        <div className=\"appForm\">\n                            <Switch>\n                                <Route path=\"/sign-in\">\n                                <div className=\"formTitle\"> \n                                    <div className=\"formTitle\"> Please sign in</div>            \n                                    <SignInForm />\n                                </div>\n                                </Route>\n                                <PrivateRoute path=\"/welcome\">\n                                <div className=\"formTitle\"> \n                                    <div className=\"formTitle\"> Welcome you</div>\n                                    <Welcome />\n                                </div>\n                                </PrivateRoute>\n                                <Redirect to=\"/sign-in\" />\n                            </Switch>\n                        </div>\n                    </div>\n                    \n                </Router>\n            </AppContext.Provider>\n        )\n    );\n}\n\nexport default App;","const config = {\n    // Backend config\n    apiGateway: {\n      REGION: 'eu-west-3',\n      URL: 'https://ivz4b9m4g0.execute-api.eu-west-3.amazonaws.com',\n    },\n    cognito: {\n      REGION: 'eu-west-3',\n      USER_POOL_ID: 'eu-west-3_AWPEJ24Tz',\n      APP_CLIENT_ID: '3ihu80pskqv86o8v3ol89ufqr0'\n    },\n  };\n  \n  export default config;\n  ","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport config from './config';\nimport Amplify from \"aws-amplify\"\n\nAmplify.configure({\n    Auth: {\n        mandatorySignIn: true,\n        region: config.cognito.REGION,\n        userPoolId: config.cognito.USER_POOL_ID,\n        userPoolWebClientId: config.cognito.APP_CLIENT_ID\n      },\n      API: {\n        endpoints: [\n          {\n            name: \"lambda-API\",\n            endpoint: config.apiGateway.URL,\n            region: config.apiGateway.REGION\n          },\n        ]\n      }\n    });\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}